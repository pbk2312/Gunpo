<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta name="description" content="Gunpo Community ê²Œì‹œë¬¼ ìˆ˜ì •"/>
    <meta name="author" content="ì‘ì„±ì ì´ë¦„"/>
    <title>ê²Œì‹œë¬¼ ìˆ˜ì • - Gunpo Community</title>
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico"/>
    <!-- Core theme CSS (includes Bootstrap) -->
    <link href="/css/styles.css" rel="stylesheet"/>
    <style>
        body {
            background-color: #f7f7f9;
            color: #495057;
        }

        .content-container {
            max-width: 850px;
            margin: 0 auto;
            padding: 30px;
        }

        .card {
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            background-color: #ffffff;
        }

        .navbar {
            margin-bottom: 20px;
        }

        h1 {
            font-size: 2.5rem;
            color: #212529;
            font-weight: 700;
        }

        .form-group label {
            font-weight: 600;
        }

        .btn-secondary, .btn-primary {
            transition: background-color 0.3s ease;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }

        .image-container {
            position: relative;
            display: inline-block;
            margin: 10px;
        }

        .image-container img {
            max-height: 150px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .image-container input[type="checkbox"] {
            position: absolute;
            top: 10px;
            right: 10px;
            transform: scale(1.5); /* ì»¤ì§„ ì²´í¬ë°•ìŠ¤ */
        }

        .image-container label {
            display: block;
            text-align: center;
            margin-top: 5px;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .image-row {
            display: flex;
            flex-wrap: wrap;
            justify-content: start;
        }
    </style>
</head>
<body>
<div class="d-flex" id="wrapper">
    <!-- Sidebar -->
    <div class="border-end bg-white" id="sidebar-wrapper">
        <div class="sidebar-heading border-bottom bg-light">Gunpo Community</div>
        <div class="list-group list-group-flush">
            <a class="list-group-item list-group-item-action list-group-item-light p-3" href="#!">ê³µì§€ì‚¬í•­</a>
            <a class="list-group-item list-group-item-action list-group-item-light p-3" href="/chat">ì‹¤ì‹œê°„ ì±„íŒ…</a>
            <a class="list-group-item list-group-item-action list-group-item-light p-3" href="#!">ì´ë²¤íŠ¸</a>
            <a class="list-group-item list-group-item-action list-group-item-light p-3" href="/board/list">ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œíŒ</a>
            <a class="list-group-item list-group-item-action list-group-item-light p-3" href="/smoking-area">í¡ì—°êµ¬ì—­</a>
            <a class="list-group-item list-group-item-action list-group-item-light p-3" href="#!">ì‚¬ì§„ ê°¤ëŸ¬ë¦¬</a>
            <a class="list-group-item list-group-item-action list-group-item-light p-3" href="/news">ë‰´ìŠ¤</a>
        </div>
    </div>

    <!-- Page content wrapper -->
    <div id="page-content-wrapper">
        <!-- Top navigation -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
            <div class="container-fluid">
                <a class="navbar-brand" href="/">
                    <span class="icon">ğŸ </span>
                    <span class="text">í™ˆìœ¼ë¡œ</span>
                </a>
            </div>
        </nav>

        <!-- ìˆ˜ì • í˜ì´ì§€ ì»¨í…ì¸  -->
        <div class="container-fluid mt-4 content-container">
            <!-- ê²Œì‹œë¬¼ ìˆ˜ì • ì œëª© -->
            <h1 class="mb-4 text-center">ê²Œì‹œë¬¼ ìˆ˜ì •</h1>

            <!-- ê²Œì‹œë¬¼ ìˆ˜ì • í¼ -->
            <div class="card">
                <div class="card-body">
                    <form id="updateForm" enctype="multipart/form-data">
                        <input type="hidden" name="id" th:value="${board.id}"/>

                        <div class="form-group mb-3">
                            <label for="title">ì œëª©</label>
                            <input type="text" class="form-control" id="title" name="title" th:value="${board.title}"
                                   required maxlength="255"/>
                        </div>

                        <div class="form-group mb-3">
                            <label for="content">ë‚´ìš©</label>
                            <textarea class="form-control" id="content" name="content" rows="8" required
                                      th:text="${board.content}"></textarea>
                        </div>

                        <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ ë¶€ë¶„ -->
                        <div class="form-group mb-3">
                            <label for="category">ì¹´í…Œê³ ë¦¬</label>
                            <select class="form-control" id="category" name="category" required>
                                <option value="ì¡ë‹´" th:selected="${board.category == 'ì¡ë‹´'}">ì¡ë‹´</option>
                                <option value="ê³ ë¯¼" th:selected="${board.category == 'ê³ ë¯¼'}">ê³ ë¯¼</option>
                                <option value="ì§ˆë¬¸" th:selected="${board.category == 'ì§ˆë¬¸'}">ì§ˆë¬¸</option>
                                <option value="ì •ë³´ê³µìœ " th:selected="${board.category == 'ì •ë³´ê³µìœ '}">ì •ë³´ê³µìœ </option>
                                <option value="ì¼ìƒ" th:selected="${board.category == 'ì¼ìƒ'}">ì¼ìƒ</option>
                            </select>
                        </div>

                        <!-- ê¸°ì¡´ ì´ë¯¸ì§€ í‘œì‹œ ë° ì‚­ì œ ì„ íƒ -->
                        <div class="form-group mb-3">
                            <label>ì´ë¯¸ì§€ ì‚­ì œ</label>
                            <div class="image-row">
                                <div class="image-container" th:each="imagePath, iterStat : ${board.imagePaths}">
                                    <img th:src="${imagePath}" alt="ê²Œì‹œë¬¼ ì´ë¯¸ì§€" class="img-fluid mb-2"/>
                                    <input type="checkbox" id="deleteImage__${iterStat.index}" name="deleteImages"
                                           th:value="${imagePath}"/>
                                    <label th:for="'deleteImage__' + ${iterStat.index}"></label>
                                </div>
                            </div>
                        </div>

                        <!-- ìƒˆ ì´ë¯¸ì§€ ì¶”ê°€ -->
                        <div class="form-group mb-3">
                            <label for="newImages">ìƒˆ ì´ë¯¸ì§€ ì¶”ê°€</label>
                            <input type="file" class="form-control" id="newImages" name="newImages" multiple
                                   accept="image/*"/>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block">ê²Œì‹œë¬¼ ìˆ˜ì •</button>
                    </form>
                </div>
            </div>

            <!-- ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼ -->
            <div class="text-center mt-3">
                <a href="/board/list" class="btn btn-secondary">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap core JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- JavaScript for PUT request using Fetch API -->
<script>
    document.getElementById("updateForm").onsubmit = async function (event) {
        event.preventDefault(); // ê¸°ë³¸ í¼ ì œì¶œ ë°©ì§€

        // FormDataë¡œ í¼ ë°ì´í„° ìˆ˜ì§‘
        let formData = new FormData(this);

        try {
            let response = await fetch("/api/board/update", {
                method: "PUT",  // PUT ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ ì „ì†¡
                body: formData
            });

            // ì‘ë‹µì´ ì„±ê³µì ì¼ ê²½ìš°
            if (response.ok) {
                window.location.href = "/board/list"; // ìˆ˜ì • í›„ ëª©ë¡ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜
            } else {
                alert("ê²Œì‹œë¬¼ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            }
        } catch (error) {
            console.error("Error during the update:", error);
            alert("ì„œë²„ ì˜¤ë¥˜ë¡œ ì¸í•´ ê²Œì‹œë¬¼ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
    };
</script>
</body>
</html>
