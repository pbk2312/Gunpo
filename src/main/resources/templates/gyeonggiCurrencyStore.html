<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta name="description" content=""/>
    <meta name="author" content=""/>
    <title>Gunpo - ê²½ê¸° ì§€ì—­í™”í ê°€ë§¹ì </title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico"/>
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet"/>
</head>
<style>
    .alert {
        background-color: #f0f8ff;
        border: 1px solid #007bff;
        border-radius: 8px;
        padding: 20px;
    }

    .alert h3 {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: #007bff;
    }

    .alert p {
        font-size: 1.1rem;
        color: #333;
    }
</style>
<body>
<div class="d-flex" id="wrapper">
    <!-- Sidebar-->
    <div class="border-end bg-white" id="sidebar-wrapper">
        <div class="sidebar-heading border-bottom bg-light">Gunpo Community</div>
        <div class="list-group list-group-flush">
            <a class="list-group-item list-group-item-action list-group-item-light p-3" href="/inquiry-list">ë¬¸ì˜í•˜ê¸°</a>
            <a class="list-group-item list-group-item-action list-group-item-light p-3" href="/chat">ì‹¤ì‹œê°„ ì±„íŒ…</a>
            <a class="list-group-item list-group-item-action list-group-item-light p-3" href="/chat/rooms">1ëŒ€1 ì±„íŒ…ë°©
                ëª©ë¡</a>
            <a class="list-group-item list-group-item-action list-group-item-light p-3" href="/GyeonggiCurrencyStore">ê²½ê¸°
                ì§€ì—­í™”í ê°€ë§¹ì  ì°¾ê¸°</a>
            <a class="list-group-item list-group-item-action list-group-item-light p-3" href="/board/list">ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œíŒ</a>
            <a class="list-group-item list-group-item-action list-group-item-light p-3" href="/smoking-area">í¡ì—° êµ¬ì—­</a>
            <a class="list-group-item list-group-item-action list-group-item-light p-3" href="/news">ë‰´ìŠ¤</a>
        </div>
    </div>
    <!-- Page content wrapper-->
    <div id="page-content-wrapper">
        <!-- Top navigation-->
        <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
            <div class="container-fluid">
                <a class="navbar-brand" href="/">
                    <span class="icon">ğŸ </span>
                    <span class="text">í™ˆìœ¼ë¡œ</span>
                </a>
            </div>
        </nav>

        <!-- Description Section -->
        <div class="container mt-4">
            <div class="alert alert-primary shadow-sm rounded" role="alert"
                 style="background-image: linear-gradient(to right, #007bff, #00c6ff); color: white; padding: 20px; border: none;">
                <h3 class="mb-3"
                    style="font-family: 'Poppins', sans-serif; font-weight: bold; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4); color: yellowgreen;">
                    ğŸŒŸ Gunpo - ê²½ê¸° ì§€ì—­í™”í ê°€ë§¹ì  ì•ˆë‚´
                </h3>
                <p style="
        font-size: 1.1rem;
        font-family: 'Open Sans', sans-serif;
        line-height: 1.8;
        color: black;
        background-color: #f9f9f9;
        padding: 1rem;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);">
                    <span style="color: black;">êµ°í¬ì‹œì—ì„œ ì§€ì—­í™”íë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê°€ë§¹ì  ì •ë³´ë¥¼ í™•ì¸í•´ ë³´ì„¸ìš”!</span><br/>
                    ì•„ë˜ ê²€ìƒ‰ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ ì›í•˜ëŠ” ìƒí˜¸ëª…ì„ ì°¾ì•„ë³´ê±°ë‚˜, ì§€ë„ë¥¼ íƒìƒ‰í•˜ë©° ë‹¤ì–‘í•œ ê°€ë§¹ì ì„ ë°œê²¬í•˜ì„¸ìš”.
                </p>
            </div>
            <!-- Search Form -->
            <form id="searchForm" class="mb-3 d-flex">
                <input type="text" id="storeName" placeholder="ìƒí˜¸ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" class="form-control mb-2" style="flex-grow: 1;">
                <button type="submit" class="btn btn-primary ml-2" style="display: inline-flex; align-items: center; justify-content: center; white-space: nowrap;">ê²€ìƒ‰</button>
            </form>
        </div>

        <div id="map" style="width:100%;height:600px;"></div>
    </div>
</div>

<footer class="bg-dark text-white text-center py-4">
    <div class="container">
        <p>&copy; 2024 Gunpo Community Platform. All rights reserved.</p>
        <p>Contact us: <a href="mailto:support@gunpocommunity.kr" class="text-white">support@gunpocommunity.kr</a></p>
        <p>
            <a href="#!" class="text-white">Privacy Policy</a> |
            <a href="#!" class="text-white">Terms of Service</a> |
            <a href="#!" class="text-white">Contact Us</a>
        </p>
    </div>
</footer>

<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Kakao Map JS API -->
<script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=24041f4fcf6aacc6f4709847750e76c2"></script>
<script>
    let map; // Kakao Map ê°ì²´
    let markers = []; // ìƒì„±ëœ ë§ˆì»¤ë¥¼ ì €ì¥í•  ë°°ì—´
    let infoWindows = []; // ì •ë³´ì°½ì„ ì €ì¥í•  ë°°ì—´

    // Fetch data from the server
    async function fetchCurrencyStores() {
        try {
            const response = await fetch('/api/GyeonggiCurrencyStoreInfo');
            if (!response.ok) {
                throw new Error('Failed to fetch data from the server');
            }
            const result = await response.json();
            return result.data; // APIì˜ data ë¶€ë¶„ ë°˜í™˜
        } catch (error) {
            console.error('Error fetching data:', error);
            return [];
        }
    }

    // Initialize Kakao Map
    async function initMap() {
        const stores = await fetchCurrencyStores();

        const mapContainer = document.getElementById('map'); // ì§€ë„ë¥¼ í‘œì‹œí•  div
        const mapOption = {
            center: new kakao.maps.LatLng(37.3625, 126.9357), // êµ°í¬ì‹œ ì¤‘ì‹¬
            level: 3 // ì§€ë„ í™•ëŒ€ ë ˆë²¨ // ì‘ì„ ìˆ˜ë¡ ë” í™•ëŒ€
        };
        map = new kakao.maps.Map(mapContainer, mapOption);

        // Add markers to the map
        stores.forEach(store => {
            const lat = parseFloat(store.REFINE_WGS84_LAT);
            const lng = parseFloat(store.REFINE_WGS84_LOGT);

            if (!isNaN(lat) && !isNaN(lng)) {
                const position = new kakao.maps.LatLng(lat, lng);
                const marker = new kakao.maps.Marker({
                    map: map,
                    position: position
                });

                // Add info window to marker
                const infoWindow = new kakao.maps.InfoWindow({
                    content: `<div style="padding:5px;">
                                <strong>${store.CMPNM_NM}</strong><br/>
                                ${store.INDUTYPE_NM}
                              </div>`
                });

                // Show info window on hover
                kakao.maps.event.addListener(marker, 'mouseover', function () {
                    infoWindow.open(map, marker);
                });

                // Hide info window on mouse out
                kakao.maps.event.addListener(marker, 'mouseout', function () {
                    infoWindow.close();
                });

                markers.push({marker, store}); // ë§ˆì»¤ì™€ ìƒí˜¸ëª… ë§¤í•‘
            }
        });
    }

    // Search for a store and move the map
    // Search for stores and display them on the map
    async function searchStore(event) {
        event.preventDefault(); // í¼ ê¸°ë³¸ ë™ì‘ ë°©ì§€

        const storeName = document.getElementById('storeName').value.trim();
        if (!storeName) {
            alert('ìƒí˜¸ëª…ì„ ì…ë ¥í•˜ì„¸ìš”.');
            return;
        }

        // ê¸°ì¡´ ì •ë³´ì°½ ë‹«ê¸°
        infoWindows.forEach(infoWindow => infoWindow.close());
        infoWindows = []; // ë°°ì—´ ì´ˆê¸°í™”

        // ê²€ìƒ‰ì–´ê°€ ìƒí˜¸ëª…ì— í¬í•¨ëœ ëª¨ë“  ë§ˆì»¤ ì°¾ê¸°
        const foundMarkers = markers.filter(({store}) => store.CMPNM_NM.includes(storeName));

        if (foundMarkers.length > 0) {
            // ì§€ë„ ë²”ìœ„ ì„¤ì •ì„ ìœ„í•œ LatLngBounds ê°ì²´ ìƒì„±
            const bounds = new kakao.maps.LatLngBounds();

            foundMarkers.forEach(({marker, store}) => {
                const position = marker.getPosition();

                // ì§€ë„ ë²”ìœ„ì— ë§ˆì»¤ ìœ„ì¹˜ ì¶”ê°€
                bounds.extend(position);

                // ë§ˆì»¤ì— ëŒ€í•œ ì •ë³´ì°½ ìƒì„±
                const infoWindow = new kakao.maps.InfoWindow({
                    content: `<div style="padding:5px;">
                            <strong>${store.CMPNM_NM}</strong><br/>
                            ${store.INDUTYPE_NM}
                          </div>`
                });

                // ì •ë³´ì°½ ì—´ê¸°
                infoWindow.open(map, marker);

                // ì—´ë¦° ì •ë³´ì°½ ë°°ì—´ì— ì €ì¥
                infoWindows.push(infoWindow);
            });

            // ì§€ë„ ì¤‘ì‹¬ê³¼ ë²”ìœ„ë¥¼ ê²€ìƒ‰ ê²°ê³¼ì— ë§ê²Œ ì¡°ì •
            map.setBounds(bounds);

            alert(`"${storeName}"ì´(ê°€) í¬í•¨ëœ ê°€ë§¹ì  ${foundMarkers.length}ê°œë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.`);
        } else {
            alert(`"${storeName}"ì´(ê°€) í¬í•¨ëœ ê°€ë§¹ì ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
        }
    }

    // Initialize the map and bind search form
    window.onload = function () {
        initMap();

        // ê²€ìƒ‰ í¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        const searchForm = document.getElementById('searchForm');
        searchForm.addEventListener('submit', searchStore);
    };
</script>
</body>
</html>
